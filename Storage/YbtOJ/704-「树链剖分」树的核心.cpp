#include<bits/stdc++.h>
using namespace std;constexpr int MAX_N=1e5+10;struct Nd{int l,r;long long s;int d;};struct Ed{int to,next;};int n,q;Nd sg[MAX_N*4];Ed tr[MAX_N*2];int t,hd[MAX_N];int de[MAX_N],fa[MAX_N],so[MAX_N],sz[MAX_N],tp[MAX_N];int tmr,dn[MAX_N],rv[MAX_N];int st[MAX_N][18],lm[MAX_N];void pu(int x){sg[x].s=sg[x<<1].s+sg[x<<1|1].s;}void up(int x,int v){sg[x].s+=1ll*v*(sg[x].r-sg[x].l+1);sg[x].d+=v;}void pd(int x){if(sg[x].d){up(x<<1,sg[x].d);up(x<<1|1,sg[x].d);sg[x].d=0;}}void bu(int x,int l,int r){sg[x].l=l;sg[x].r=r;if(l==r)return;int mid=(l+r)>>1;bu(x<<1,l,mid);bu(x<<1|1,mid+1,r);}void d(int x,int l,int r,int v){if(l<=sg[x].l&&sg[x].r<=r){up(x,v);return;}int mid=(sg[x].l+sg[x].r)>>1;pd(x);if(l<=mid)d(x<<1,l,r,v);if(mid<r)d(x<<1|1,l,r,v);pu(x);}long long qu(int x,int l,int r){if(l<=sg[x].l&&sg[x].r<=r)return sg[x].s;int mid=(sg[x].l+sg[x].r)>>1;long long res=0;pd(x);if(l<=mid)res+=qu(x<<1,l,r);if(mid<r)res+=qu(x<<1|1,l,r);return res;}int fd(int x,long long v){if(sg[x].l==sg[x].r)return sg[x].l;pd(x);if((sg[x<<1].s<<1)>v)return fd(x<<1,v);else return fd(x<<1|1,v-(sg[x<<1].s<<1));}void lk(int x,int y){tr[++t]={y,hd[x]};hd[x]=t;}void df(int x){sz[x]=1;de[x]=de[fa[x]]+1;st[x][0]=fa[x];for(int i=1;i<=17;++i){st[x][i]=st[st[x][i-1]][i-1];if(!st[x][i]){lm[x]=i-1;break;}}for(int i=hd[x],y;y=tr[i].to,i;i=tr[i].next){df(y);sz[x]+=sz[y];if(sz[y]>sz[so[x]])so[x]=y;}}void df(int x,int t){tp[x]=t;dn[x]=++tmr;rv[tmr]=x;if(so[x])df(so[x],t);for(int i=hd[x],y;y=tr[i].to,i;i=tr[i].next){if(y==so[x])continue;df(y,y);}}inline void dTr(int x,int v){d(1,dn[x],dn[x]+sz[x]-1,v);}void dCh(int x,int y,int v){int fx=tp[x],fy=tp[y];while(fx!=fy){if(de[fx]>de[fy]){d(1,dn[fx],dn[x],v);x=fa[fx];fx=tp[x];}else{d(1,dn[fy],dn[y],v);y=fa[fy];fy=tp[y];}}if(de[x]<de[y])d(1,dn[x],dn[y],v);else d(1,dn[y],dn[x],v);}inline long long qu(int x){return qu(1,dn[x],dn[x]+sz[x]-1);}int jp(int x){if((qu(x)<<1)>sg[1].s)return x;for(int i=lm[x];i>=0;--i){if(st[x][i]&&(qu(st[x][i])<<1)<=sg[1].s)x=st[x][i];}if(st[x][0]&&(qu(x)<<1)<=sg[1].s)x=st[x][0];return x;}int main(){
#ifdef ONLINE_JUDGE
freopen("core.in","r",stdin);freopen("core.out","w",stdout);
#endif
cin>>n>>q;for(int i=2;i<=n;++i){cin>>fa[i];lk(fa[i],i);}df(1);df(1,1);bu(1,1,n);for(int i=1;i<=q;++i){int op;cin>>op;if(op==1){int x;cin>>x;dTr(x,1);}else{int x,y;cin>>x>>y;dCh(x,y,1);}int p=fd(1,sg[1].s);cout<<jp(rv[p])<<"\n";}return 0;}
